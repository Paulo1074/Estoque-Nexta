<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gerenciador de Estoque</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <button id="toggle-sidebar" class="hamburger">☰</button>

    <div class="app">
        <aside class="sidebar">
            <div class="logo">
                <img src="img/nexta.jpg" alt="Logo Estoque Nexta" class="logo-img">
                <h1>Estoque NEXTA</h1>
            </div>

            <div class="nav">
                <a href="index.html" class="btn-nav active">Movimentações</a>
                <a href="uniforme.html" class="btn-nav">Uniformes</a>
                <a href="Brindes.html" class="btn-nav">Materiais Marketing</a>
                <a href="EstoqueRoupas.html" class="btn-nav">Estoque Roupas</a>
                <a href="EstoqueMkt.html" class="btn-nav">Estoque Materiais</a>
            </div>
        </aside>

        <main class="main">
            <header>
                <h2>Movimentações de estoque</h2>
                <div class="controls">
                    <input id="search" placeholder="Buscar descrição ou produto">
                    <button class="btn danger" id="limpar-dados">Limpar dados</button>
                </div>
            </header>

            <div class="grid">
                <div class="panel">
                    <div class="panel-header">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Data / Hora</th>
                                        <th>Produto</th>
                                        <th>Destinatário</th>
                                        <th>Tipo</th>
                                        <th>Qnt. mov.</th>
                                        <th>Qnt. final</th>
                                        <th>Custo unit.</th>
                                        <th>Custo total</th>
                                        <th>Descrição</th>
                                        <th>Cidade de Origem</th>
                                        <th>Cidade de Destino</th>
                                    </tr>
                                </thead>
                                <tbody id="moves-tbody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const movesTbody = document.getElementById('moves-tbody');

        // Função para carregar movimentações apenas de brindes e uniformes
        function carregarMovimentacoes() {
            movesTbody.innerHTML = '';

            const uniformes = JSON.parse(localStorage.getItem('uniformes')) || [];
            const brindes = JSON.parse(localStorage.getItem('brindes')) || [];

            const todosRegistros = [...brindes, ...uniformes];
            todosRegistros.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));

            todosRegistros.forEach(item => {
                const tr = document.createElement('tr');
                const tipo = (item.tipo || item.type || '').toLowerCase().trim();
                if (tipo === 'entrada') tr.classList.add('row-entrada');
                else if (tipo === 'saida') tr.classList.add('row-saida');

                const dataStr = item.timestamp ? new Date(item.timestamp).toLocaleString() : item.dateTime || '-';

                tr.innerHTML = `
            <td>${dataStr}</td>
            <td>${item.name || item.nome || '-'}</td>
            <td>${item.sender || item.nomePessoa || item.remetente || '-'}</td>
            <td>${item.type || item.tipo || 'Item'}</td>
            <td>${item.quantidadeMovimentada || item.quantity || 0}</td>
            <td>${item.quantidadeFinal || item.quantity || 0}</td>
            <td>${item.custoUnitario || '-'}</td>
            <td>${item.custoTotal || '-'}</td>
            <td>${item.description || item.descricao || '-'}</td>
            <td>${item.origin || item.origem || '-'}</td>
            <td>${item.destination || item.destino || '-'}</td>
        `;
                movesTbody.appendChild(tr);
            });
        }

        // Atualiza automaticamente quando localStorage muda
        window.addEventListener('storage', event => {
            if (['uniformes', 'brindes'].includes(event.key)) {
                carregarMovimentacoes();
            }
        });

        // BOTÃO LIMPAR TODOS OS DADOS
        document.getElementById('limpar-dados').addEventListener('click', () => {
            if (confirm("Deseja realmente remover TODOS os dados de brindes e uniformes?")) {
                localStorage.removeItem('brindes');
                localStorage.removeItem('uniformes');
                alert("Todos os dados foram removidos.");
                carregarMovimentacoes();
            }
        });

        // FILTRO DE BUSCA
        const searchInput = document.getElementById('search');
        searchInput.addEventListener('input', () => {
            const filter = searchInput.value.toLowerCase();
            const rows = movesTbody.getElementsByTagName('tr');
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                let match = false;
                const searchableIndices = [1, 2, 8, 9, 10];
                for (let index of searchableIndices) {
                    if (cells[index] && cells[index].textContent.toLowerCase().includes(filter)) {
                        match = true;
                        break;
                    }
                }
                rows[i].style.display = match ? '' : 'none';
            }
        });

        // hamburger menu
        const toggleBtn = document.getElementById('toggle-sidebar');
        const sidebar = document.querySelector('.sidebar');
        toggleBtn.addEventListener('click', () => {
            sidebar.classList.toggle('closed');
            toggleBtn.textContent = sidebar.classList.contains('closed') ? '☰' : '✖';
        });

        // Carrega ao abrir a página
        window.onload = carregarMovimentacoes;
    </script>

</body>

</html>